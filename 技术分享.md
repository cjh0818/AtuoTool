# Open-AutoGLM / AutoGLM-Phone 安装与配置教程

> 目标：把 **Open-AutoGLM（Phone Agent）** 跑起来，让 AI 能“看懂手机屏幕 + 通过 ADB 自动操作手机”。

---

## 1. Open-AutoGLM（Phone Agent）它是什么？能做什么？

Open-AutoGLM（Phone Agent）是一个基于 AutoGLM 的手机端智能体框架：  
- **视觉理解**：理解当前手机屏幕内容  
- **任务规划**：把自然语言指令拆成步骤  
- **自动执行**：通过 **ADB** 点击/滑动/输入等操作完成任务  
- **安全机制**：对敏感操作支持确认，并允许登录/验证码等场景人工接管

Open-AutoGLM 采用「本地 PC/服务器运行大模型 + ADB 远程控制 Android 手机」的架构
架构说明：

- **推理端**：在本地 GPU 服务器上运行 vLLM 或 SGlang，提供与大模型对话的 OpenAI 兼容 API
- **控制端**：phone_agent 通过 HTTP API 与推理端通信，使用 ADB 协议控制手机
- **设备端**：Android 手机通过 ADB 接收指令，执行自动化操作

指令示例：  
- “打开美团搜索附近的火锅店”  
- “打开小红书搜美食”

github地址
```bash
https://github.com/zai-org/Open-AutoGLM
```

---

## 2. 准备清单

### PC 侧
- Python：**3.10+**（建议 3.10/3.11）
- ADB：Android 平台工具 **platform-tools**，并加入 PATH
- 一根**支持数据传输**的 USB 线

### 手机侧（Android）
- Android **7.0+**
- 开启：开发者选项、USB 调试、以及部分机型需要的“USB 调试（安全设置）/USB 安装”等
- 安装并启用 **ADB Keyboard**（用于自动输入文本）


---

## 3. Step 1：安装并验证 ADB（PC）

### 3.1 安装 platform-tools
直接下载：
```bash
# 创建目录
mkdir -p ~/android-sdk/platform-tools
cd ~/android-sdk

# 下载 platform-tools（Linux/macOS）
wget https://dl.google.com/android/repository/platform-tools-latest-linux.zip

# 解压
unzip platform-tools-latest-linux.zip
```

### 3.2 配置环境变量
macOS（~/.zshrc）
```bash
export ANDROID_HOME=~/android-sdk
export PATH=$PATH:$ANDROID_HOME/platform-tools
export PATH=$PATH:$ANDROID_HOME/emulator
export PATH=$PATH:$ANDROID_HOME/tools
export PATH=$PATH:$ANDROID_HOME/tools/bin
```

### 3.3 验证 ADB 是否可用
打开终端/命令行运行：
```bash
# 检查 ADB 版本
adb version

# 应显示类似：
# Android Debug Bridge version 1.x.x
# Version 31.0.1 etc.

# 测试 ADB 连接
adb devices
# 应显示：List of devices attached（无设备是正常的）
```

## 4. Step 2：手机开启开发者模式 + USB 调试（Android）

不同品牌手机可能略有不同：

1. **开启开发者模式**  
   设置 → 关于手机 → 连续点击 **“版本号 / OS 版本”** 若干次，直到提示已开启开发者模式

2. **开启 USB 调试**  
   设置 → 开发者选项 → 打开 **USB 调试**

3. **按机型补充开启（可选但常见）**  
   部分机型还需要打开以下开关（名称可能略有差异）：  
   - USB 安装  
   - USB 调试（安全设置）  
   - 允许通过 USB 安装应用 / 允许修改系统设置

连接 USB 后手机通常会弹出 **“是否允许 USB 调试”** 的授权提示，请选择 **允许**。

## 5. Step 3：连接确认

把手机用 USB 连接电脑后，在电脑运行：

```bash
adb devices
```

输出设备id代表连接成功：
```text
List of devices attached
XXXXXXXXXXXXXXX    device
```

## 6. Step 4：安装并启用 ADB Keyboard（用于自动输入）

ADB Keyboard 是 Android 端用于文本输入的关键组件。

### 6.1 安装 ADBKeyboard.apk

可以在手机上直接下载安装包，也可以用 ADB 安装。常见方式（在 APK 所在目录执行）：

```bash
adb install ADBKeyboard.apk
```

### 6.2 启用并切换输入法（命令方式）
```bash
adb shell ime enable com.android.adbkeyboard/.AdbIME
adb shell ime set com.android.adbkeyboard/.AdbIME
```

这两条命令能把输入法启用并切到 ADB Keyboard。

## 7. Step 5：安装 Open-AutoGLM

### 7.1 获取源码
```bash
git clone https://github.com/zai-org/Open-AutoGLM.git
cd Open-AutoGLM
```

### 7.2 使用 venv 创建虚拟环境
```bash
python -m venv .venv
# Windows
.venv\Scripts\activate
# macOS/Linux
source .venv/bin/activate
```

### 7.3 安装依赖

在项目根目录（与 main.py 同级）执行：

```bash
pip install -r requirements.txt
pip install -e .
```

## 8. Step 6：使用智谱云端模型 BigModel 启动

### 8.1 智谱 BigModel

- `--base-url`：`https://open.bigmodel.cn/api/paas/v4`
- `--model`：`autoglm-phone`
- `--apikey`：在智谱平台申请

运行示例（把 key 换成你的）：
```bash
python main.py \
  --base-url https://open.bigmodel.cn/api/paas/v4 \
  --model "autoglm-phone" \
  --apikey "your-bigmodel-api-key" \
  "打开美团搜索附近的火锅店"
```

## 9. 常见问题与排障

### 9.1 adb devices 没设备 / 一直空

优先排查：
- 数据线是否支持传输
- 手机是否弹出“允许 USB 调试”但你没点
- 电脑 USB 口/驱动问题

### 9.2 unauthorized

- 解锁手机 → 重新插拔 → 在弹窗中允许调试
- 或在开发者选项里撤销 USB 调试授权，再重连

### 9.3 能点但不能输入

- 检查 ADB Keyboard 是否已启用并设为当前输入法
- 重新执行启用/切换命令（见第 6 节）

### 9.4 提示“敏感屏幕/黑屏，无法操作”

有用户遇到某些 App 或安全策略导致屏幕被标记为敏感：
- 等待页面加载完成后重试
- 检查系统安全/隐私限制
- 必要时换线
